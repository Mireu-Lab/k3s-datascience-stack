---
# Example IngressRoute configurations with JWT authentication
# Apply JWT middleware to protect services in *.mireu.xyz domain

# Spark IngressRoute with JWT
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: spark-ingress-https
  namespace: spark-operator
spec:
  entryPoints:
    - websecure
  routes:
    - match: Host(`spark.mireu.xyz`)
      kind: Rule
      services:
        - name: spark-cluster-master-svc
          port: 8080
      middlewares:
        - name: security-headers
          namespace: traefik
        - name: rate-limit
          namespace: traefik
        # Optional: Enable JWT auth for token-based access
        # - name: oauth2-proxy
        #   namespace: traefik
  tls:
    secretName: cloudflare-origin-cert
---
# HDFS IngressRoute with JWT
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: hdfs-ingress-https
  namespace: hdfs
spec:
  entryPoints:
    - websecure
  routes:
    - match: Host(`hdfs.mireu.xyz`)
      kind: Rule
      services:
        - name: hdfs-cluster-namenode-default
          port: 9870
      middlewares:
        - name: security-headers
          namespace: traefik
        - name: rate-limit
          namespace: traefik
        # Optional: Enable JWT auth for token-based access
        # - name: oauth2-proxy
        #   namespace: traefik
  tls:
    secretName: cloudflare-origin-cert
---
# PostgreSQL/PgAdmin IngressRoute with JWT
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: pgadmin-ingress-https
  namespace: postgres
spec:
  entryPoints:
    - websecure
  routes:
    - match: Host(`pgadmin.mireu.xyz`)
      kind: Rule
      services:
        - name: pgadmin-service
          port: 80
      middlewares:
        - name: security-headers
          namespace: traefik
        - name: rate-limit
          namespace: traefik
        # Optional: Enable OAuth2 for web UI access
        # - name: oauth2-proxy
        #   namespace: traefik
  tls:
    secretName: cloudflare-origin-cert
---
# JupyterHub IngressRoute (OAuth already configured in app)
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: jupyterhub-ingress-https
  namespace: jupyterhub
spec:
  entryPoints:
    - websecure
  routes:
    - match: Host(`jupyter.mireu.xyz`)
      kind: Rule
      services:
        - name: proxy-public
          port: 80
      middlewares:
        - name: security-headers
          namespace: traefik
        - name: compression
          namespace: traefik
  tls:
    secretName: cloudflare-origin-cert
---
# Grafana IngressRoute (OAuth already configured in app)
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: grafana-ingress-https
  namespace: grafana
spec:
  entryPoints:
    - websecure
  routes:
    - match: Host(`grafana.mireu.xyz`)
      kind: Rule
      services:
        - name: grafana-service
          port: 3000
      middlewares:
        - name: security-headers
          namespace: traefik
        - name: compression
          namespace: traefik
  tls:
    secretName: cloudflare-origin-cert
