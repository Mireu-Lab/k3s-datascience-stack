---
# Kubernetes Cluster Dashboard
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: k3s-cluster-dashboard
  namespace: grafana
spec:
  resyncPeriod: 30s
  instanceSelector:
    matchLabels:
      dashboards: "grafana"
  json: |
    {
      "title": "K3s Cluster Monitoring",
      "timezone": "browser",
      "refresh": "30s",
      "tags": ["kubernetes", "k3s", "cluster"],
      "schemaVersion": 27,
      "panels": [
        {
          "id": 1,
          "title": "CPU Usage",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
          "targets": [
            {
              "expr": "sum(rate(container_cpu_usage_seconds_total[5m])) by (pod)",
              "legendFormat": "{{pod}}"
            }
          ]
        },
        {
          "id": 2,
          "title": "Memory Usage",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
          "targets": [
            {
              "expr": "sum(container_memory_usage_bytes) by (pod)",
              "legendFormat": "{{pod}}"
            }
          ]
        },
        {
          "id": 3,
          "title": "Pod Status",
          "type": "stat",
          "gridPos": {"h": 4, "w": 6, "x": 0, "y": 8},
          "targets": [
            {
              "expr": "count(kube_pod_info)"
            }
          ]
        },
        {
          "id": 4,
          "title": "Node Status",
          "type": "stat",
          "gridPos": {"h": 4, "w": 6, "x": 6, "y": 8},
          "targets": [
            {
              "expr": "count(kube_node_info)"
            }
          ]
        }
      ],
      "time": {
        "from": "now-6h",
        "to": "now"
      }
    }
---
# HDFS Monitoring Dashboard
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: hdfs-monitoring-dashboard
  namespace: grafana
spec:
  resyncPeriod: 30s
  instanceSelector:
    matchLabels:
      dashboards: "grafana"
  json: |
    {
      "title": "HDFS Cluster Monitoring",
      "timezone": "browser",
      "refresh": "1m",
      "tags": ["hdfs", "storage", "datascience"],
      "schemaVersion": 27,
      "panels": [
        {
          "id": 1,
          "title": "HDFS NameNode Status",
          "type": "stat",
          "gridPos": {"h": 6, "w": 8, "x": 0, "y": 0},
          "targets": [
            {
              "expr": "up{job='hdfs-namenode'}",
              "legendFormat": "NameNode"
            }
          ]
        },
        {
          "id": 2,
          "title": "HDFS DataNode Status",
          "type": "stat",
          "gridPos": {"h": 6, "w": 8, "x": 8, "y": 0},
          "targets": [
            {
              "expr": "count(up{job='hdfs-datanode'} == 1)",
              "legendFormat": "Active DataNodes"
            }
          ]
        },
        {
          "id": 3,
          "title": "HDFS Capacity",
          "type": "gauge",
          "gridPos": {"h": 6, "w": 8, "x": 16, "y": 0},
          "targets": [
            {
              "expr": "hdfs_capacity_used / hdfs_capacity_total * 100",
              "legendFormat": "Used %"
            }
          ]
        },
        {
          "id": 4,
          "title": "HDFS Read/Write Rate",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 6},
          "targets": [
            {
              "expr": "rate(hdfs_bytes_read[5m])",
              "legendFormat": "Read Rate"
            },
            {
              "expr": "rate(hdfs_bytes_written[5m])",
              "legendFormat": "Write Rate"
            }
          ]
        },
        {
          "id": 5,
          "title": "ZooKeeper Status",
          "type": "stat",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 6},
          "targets": [
            {
              "expr": "count(up{job='zookeeper'} == 1)",
              "legendFormat": "Active ZK Nodes"
            }
          ]
        }
      ],
      "time": {
        "from": "now-3h",
        "to": "now"
      }
    }
---
# Spark Monitoring Dashboard
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: spark-monitoring-dashboard
  namespace: grafana
spec:
  resyncPeriod: 30s
  instanceSelector:
    matchLabels:
      dashboards: "grafana"
  json: |
    {
      "title": "Spark Cluster Monitoring",
      "timezone": "browser",
      "refresh": "30s",
      "tags": ["spark", "processing", "datascience"],
      "schemaVersion": 27,
      "panels": [
        {
          "id": 1,
          "title": "Spark Master Status",
          "type": "stat",
          "gridPos": {"h": 6, "w": 6, "x": 0, "y": 0},
          "targets": [
            {
              "expr": "up{job='spark-master'}",
              "legendFormat": "Master"
            }
          ]
        },
        {
          "id": 2,
          "title": "Spark Workers",
          "type": "stat",
          "gridPos": {"h": 6, "w": 6, "x": 6, "y": 0},
          "targets": [
            {
              "expr": "count(up{job='spark-worker'} == 1)",
              "legendFormat": "Active Workers"
            }
          ]
        },
        {
          "id": 3,
          "title": "Active Spark Applications",
          "type": "stat",
          "gridPos": {"h": 6, "w": 6, "x": 12, "y": 0},
          "targets": [
            {
              "expr": "spark_applications_active",
              "legendFormat": "Active Apps"
            }
          ]
        },
        {
          "id": 4,
          "title": "Spark Executor Memory",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 6},
          "targets": [
            {
              "expr": "spark_executor_memory_used_bytes",
              "legendFormat": "{{executor_id}}"
            }
          ]
        },
        {
          "id": 5,
          "title": "Spark Tasks",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 6},
          "targets": [
            {
              "expr": "rate(spark_tasks_completed[5m])",
              "legendFormat": "Completed"
            },
            {
              "expr": "rate(spark_tasks_failed[5m])",
              "legendFormat": "Failed"
            }
          ]
        }
      ],
      "time": {
        "from": "now-1h",
        "to": "now"
      }
    }
---
# PostgreSQL Monitoring Dashboard
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: postgres-monitoring-dashboard
  namespace: grafana
spec:
  resyncPeriod: 30s
  instanceSelector:
    matchLabels:
      dashboards: "grafana"
  json: |
    {
      "title": "PostgreSQL Cluster Monitoring",
      "timezone": "browser",
      "refresh": "1m",
      "tags": ["postgresql", "database", "datascience"],
      "schemaVersion": 27,
      "panels": [
        {
          "id": 1,
          "title": "PostgreSQL Instance Status",
          "type": "stat",
          "gridPos": {"h": 6, "w": 8, "x": 0, "y": 0},
          "targets": [
            {
              "expr": "pg_up",
              "legendFormat": "Instance {{instance}}"
            }
          ]
        },
        {
          "id": 2,
          "title": "Active Connections",
          "type": "graph",
          "gridPos": {"h": 6, "w": 8, "x": 8, "y": 0},
          "targets": [
            {
              "expr": "pg_stat_database_numbackends",
              "legendFormat": "{{datname}}"
            }
          ]
        },
        {
          "id": 3,
          "title": "Database Size",
          "type": "gauge",
          "gridPos": {"h": 6, "w": 8, "x": 16, "y": 0},
          "targets": [
            {
              "expr": "pg_database_size_bytes",
              "legendFormat": "{{datname}}"
            }
          ]
        },
        {
          "id": 4,
          "title": "Transaction Rate",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 6},
          "targets": [
            {
              "expr": "rate(pg_stat_database_xact_commit[5m])",
              "legendFormat": "Commits {{datname}}"
            },
            {
              "expr": "rate(pg_stat_database_xact_rollback[5m])",
              "legendFormat": "Rollbacks {{datname}}"
            }
          ]
        },
        {
          "id": 5,
          "title": "Replication Lag",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 6},
          "targets": [
            {
              "expr": "pg_replication_lag",
              "legendFormat": "Replica {{application_name}}"
            }
          ]
        }
      ],
      "time": {
        "from": "now-3h",
        "to": "now"
      }
    }
---
# JupyterHub Monitoring Dashboard
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: jupyterhub-monitoring-dashboard
  namespace: grafana
spec:
  resyncPeriod: 30s
  instanceSelector:
    matchLabels:
      dashboards: "grafana"
  json: |
    {
      "title": "JupyterHub Monitoring",
      "timezone": "browser",
      "refresh": "1m",
      "tags": ["jupyterhub", "notebooks", "datascience"],
      "schemaVersion": 27,
      "panels": [
        {
          "id": 1,
          "title": "Active Users",
          "type": "stat",
          "gridPos": {"h": 6, "w": 6, "x": 0, "y": 0},
          "targets": [
            {
              "expr": "jupyterhub_active_users",
              "legendFormat": "Active Users"
            }
          ]
        },
        {
          "id": 2,
          "title": "Running Servers",
          "type": "stat",
          "gridPos": {"h": 6, "w": 6, "x": 6, "y": 0},
          "targets": [
            {
              "expr": "jupyterhub_running_servers",
              "legendFormat": "Running Servers"
            }
          ]
        },
        {
          "id": 3,
          "title": "Hub Status",
          "type": "stat",
          "gridPos": {"h": 6, "w": 6, "x": 12, "y": 0},
          "targets": [
            {
              "expr": "up{job='jupyterhub'}",
              "legendFormat": "Hub"
            }
          ]
        },
        {
          "id": 4,
          "title": "User Server CPU Usage",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 6},
          "targets": [
            {
              "expr": "sum(rate(container_cpu_usage_seconds_total{namespace='jupyterhub',pod=~'jupyter-.*'}[5m])) by (pod)",
              "legendFormat": "{{pod}}"
            }
          ]
        },
        {
          "id": 5,
          "title": "User Server Memory Usage",
          "type": "graph",
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 6},
          "targets": [
            {
              "expr": "sum(container_memory_usage_bytes{namespace='jupyterhub',pod=~'jupyter-.*'}) by (pod)",
              "legendFormat": "{{pod}}"
            }
          ]
        }
      ],
      "time": {
        "from": "now-6h",
        "to": "now"
      }
    }
